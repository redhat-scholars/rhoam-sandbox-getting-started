<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Red Hat OpenShift API Management Workshop</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/rhoam-sandbox-tutorial/main/04-manage-api.html">
    <link rel="prev" href="03_lauch-sandbox.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">Red Hat OpenShift API Management Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhoam-sandbox-tutorial" data-version="main">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup Developer Sandbox for Red Hat OpenShift API Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#sandboxsignup">Signup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#apitenant">Create a API Management Tenant</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deploy.html">2. Deploy a REST API and setup for discovery</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#deploy">Deploy a REST Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#configure">Configure Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03_lauch-sandbox.html">3. Launch the API Management Dashboard</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-manage-api.html">4. Manage API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_import_the_api_into_openshift_api_management">Import the API into OpenShift API Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_enable_api_key_security">Enable API Key Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_call_the_api_using_your_api_key">Call the API using API Key</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Devnation Workshop</a></li>
    <li><a href="04-manage-api.html">4. Manage API</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/rhoam-sandbox-getting-started/edit/main/documentation/modules/ROOT/pages/04-manage-api.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_manage_the_api_with_openshift_api_management"><a class="anchor" href="#_manage_the_api_with_openshift_api_management"></a>Manage the API with OpenShift API Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will  configure and secure the API that you have already deployed on OpenShift in the previous sections.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_import_the_api_into_openshift_api_management"><a class="anchor" href="#_import_the_api_into_openshift_api_management"></a>Import the API into OpenShift API Management</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An API in OpenShift API Management is referred to as a <strong>Product</strong>. Each <strong>Product</strong> can have one or many Backends.</p>
</div>
<div class="paragraph">
<p>A <strong>Backend</strong> is a web service that OpenShift API Management will proxy requests to, based on mapping rules defined in the Product.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because you already configured the Quarkus API for Service Discovery in an earlier section, you can import it automatically as follows:</p>
</div>
<div class="paragraph">
<p>Follow these steps to import Quarkus API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>Create Product</strong> button under the APIs heading on the dashboard. This will load the New Product screen.</p>
<div class="imageblock">
<div class="content">
<img src="_images/rhoam-dashboard.png" alt="rhoam dashboard">
</div>
</div>
</li>
<li>
<p>Select the <strong>Import from OpenShift</strong> option. If this option is greyed out, click the <strong>Authenticate to enable this option</strong> link to enable it.</p>
<div class="imageblock">
<div class="content">
<img src="_images/newprod-import-from-openshift-greyed.png" alt="newprod import from openshift greyed">
</div>
</div>
</li>
<li>
<p>After selecting the <strong>Import from OpenShift</strong> option you will be able to use the dropdown fields to select:</p>
<div class="imageblock">
<div class="content">
<img src="_images/newprod-import-from-openshift.png" alt="newprod import from openshift">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The Namespace that contains your Quarkus application.</p>
</li>
<li>
<p>The <strong>rhoam-quarkus-api</strong> application.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If there is only one discoverable API, these fields are auto-populated</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click the <strong>Create Product</strong> button.</p>
</li>
<li>
<p>You will be redirected back to the OpenShift API Management dashboard where your new API Product is listed. If your Quarkus API isnâ€™t listed in the APIs section after a few moments, try refreshing the page.</p>
<div class="imageblock">
<div class="content">
<img src="_images/new-prod-added.png" alt="new prod added">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verify_the_api_product_and_backend"><a class="anchor" href="#_verify_the_api_product_and_backend"></a>Verify the API Product and Backend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can inspect the Product and Backend by following these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the <strong>rhoam-quarkus-openapi</strong> API from the <strong>Products</strong> list to visit the <strong>Overview</strong> screen.</p>
<div class="imageblock">
<div class="content">
<img src="_images/activedocs.png" alt="activedocs">
</div>
</div>
</li>
<li>
<p>Click the <strong>ActiveDocs</strong> link on the left and verify that the rhoam-quarkus-openapi Swagger 3.0 spec was imported. The Swagger docs are generated from the  <code>/q/openapi?format=json</code> endpoint in the Quarkus app</p>
</li>
<li>
<p>Expand the dropdown menu in the top navigation and select <strong>Backends</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/backend.png" alt="backend">
</div>
</div>
</li>
<li>
<p>Verify that your <strong>rhoam-quarkus-openapi</strong> Backend is listed. You should also see that it&#8217;s using a private Service URL, e.g <code><a href="http://rhoam-quarkus-openapi.user-dev.svc.cluster.local:8080" class="bare">http://rhoam-quarkus-openapi.user-dev.svc.cluster.local:8080</a></code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enable_api_key_security"><a class="anchor" href="#_enable_api_key_security"></a>Enable API Key Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift API Management routes API requests through proxies known as APIcast instances.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>APIcast is an NGINX-based API gateway that integrates your internal and external API services with the Red Hat OpenShift API Management Platform. APIcast  enforces API security rules and policies. It supports multiple authentication patterns, and API Key security is the default setting for imported APIs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since your API is now imported into OpenShift API Management, you&#8217;ll need an API Key to make authenticated requests against it.</p>
</div>
<div class="sect2">
<h3 id="_obtain_the_apicast_url_for_the_api"><a class="anchor" href="#_obtain_the_apicast_url_for_the_api"></a>Obtain the APIcast URL for the API</h3>
<div class="ulist">
<ul>
<li>
<p>In the API Management dashboard, select your <strong>rhoam-quarkus-openapi</strong> from the Products list.</p>
</li>
<li>
<p>Navigate to Integration &gt; Configuration using the side-menu. Your API is already available via the Staging APIcast, but the <strong>user_key</strong>  parameter in the <strong>Example curl</strong> for testing is set to a placeholder.</p>
<div class="imageblock">
<div class="content">
<img src="_images/missing-user-key.png" alt="missing user key">
</div>
</div>
</li>
<li>
<p>Copy the URL, e.g <a href="https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/?user_key=USER_KEY" class="bare">https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/?user_key=USER_KEY</a>, and visit it in a browser or call it using your preferred HTTP client.</p>
</li>
<li>
<p>You should have received an Authentication failed response since the API Key (user_key) placeholder value is not valid.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To obtain an API Key you need to create an Application Plan and subscribe to an Application to that plan.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_application_plan"><a class="anchor" href="#_create_an_application_plan"></a>Create an Application Plan</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In OpenShift API Management, <strong>Application Plans</strong> define usage rules and limits for your API. When a developer signs up to use your API, they can select an application plan from the ones youâ€™ve defined. For example, you might create two application plans with different limits and pricing structures for an API, e.g., one free and the other paid.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Select your <strong>rhoam-quarkus-openapi</strong> from the Products list.</p>
</li>
<li>
<p>Navigate to <strong>Applications &gt; Application Plans</strong> using the side-menu.</p>
</li>
<li>
<p>Click the <strong>Create Application Plan</strong> button.</p>
</li>
<li>
<p>Enter following values:</p>
<div class="ulist">
<ul>
<li>
<p><code>RHOAM Open API Plan</code> for Name.</p>
</li>
<li>
<p><code>rhoam-openapi-plan</code> for the System name.</p>
</li>
<li>
<p>Uncheck the Applications require approval box.</p>
<div class="imageblock">
<div class="content">
<img src="_images/create-app-plan.png" alt="create app plan">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Create Application Plan</strong>. You will be redirected to the Application Plans listing.</p>
</li>
<li>
<p>Use the <strong>Publish</strong> link shown within the kebab menu of the newly created application plan to publish it. You will notice that the state of this plan is shown as <code>published</code>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/publish-app-plan.png" alt="publish app plan">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_an_application"><a class="anchor" href="#_create_an_application"></a>Create an Application</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An <strong>Application</strong>  is a subscription to the service (API Product) through the <strong>Application Plan</strong> created in the previous step. An <strong>Application</strong> is linked to developer accounts for each application plan they sign up for. The <strong>Application</strong> is normally associated with a unique set of credentials for the API, a traffic history of the calls sent to the API, and metadata captured at application creation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, you can create an <strong>Application</strong> registered to a developer account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expand the dropdown menu in the top navigation of OpenShift API Management and select <strong>Audience</strong>.</p>
</li>
<li>
<p>Choose the default <strong>Developer</strong> account from the Account listing.</p>
<div class="imageblock">
<div class="content">
<img src="_images/account-list.png" alt="account list">
</div>
</div>
</li>
<li>
<p>From the Developer account page select the <strong>Applications</strong> link at the top.</p>
<div class="imageblock">
<div class="content">
<img src="_images/applications-list-for-developer.png" alt="applications list for developer">
</div>
</div>
</li>
<li>
<p>Click the <strong>Create Application</strong> link.</p>
</li>
<li>
<p>Use the following details to create the application:</p>
<div class="imageblock">
<div class="content">
<img src="_images/create-new-application.png" alt="create new application">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Select <strong>rhoam-quarkus-openapi</strong> for the Product, and select <strong>RHOAM Open API Plan</strong> for the Application Plan.</p>
</li>
<li>
<p>Enter <strong>Developer RHOAM Application</strong> in the Name and Description fields.</p>
</li>
<li>
<p>Click the <strong>Create Application</strong> button.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You&#8217;ll be redirected to the <strong>Developer RHOAM Application</strong> page, and should see a User Key listed under the API Credentials section.</p>
<div class="imageblock">
<div class="content">
<img src="_images/api-key-in-application.png" alt="api key in application">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_call_the_api_using_your_api_key"><a class="anchor" href="#_call_the_api_using_your_api_key"></a>Call the API using your API Key</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Now that you have a valid API Key you&#8217;re ready to make authenticated requests against your API.</p>
</li>
<li>
<p>Select your <strong>rhoam-quarkus-openapi</strong> from the Products list on the OpenShift API Management dashboard.</p>
</li>
<li>
<p>Navigate to <strong>Integration</strong> &gt; <strong>Configuration</strong> using the side-menu.</p>
<div class="imageblock">
<div class="content">
<img src="_images/staging-url.png" alt="staging url">
</div>
</div>
</li>
<li>
<p>Copy the <strong>Staging URL</strong>, e.g <a href="https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/?user_key=" class="bare">https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/?user_key=</a><em>API_KEY_GOES_HERE</em>, and visit it in browser or using your preferred HTTP client. Make sure to the URL has the API Key value!</p>
</li>
<li>
<p>Append /fruits to the path, but before the ?user_key portion of the URL. A list of fruits should be returned in JSON format.</p>
<div class="ulist">
<ul>
<li>
<p>e.g <a href="https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/fruits?user_key=" class="bare">https://user-dev-rhoam-quarkus-openapi-3scale-api.cluster.com/fruits?user_key=</a><em>API_KEY_GOES_HERE</em></p>
<div class="imageblock">
<div class="content">
<img src="_images/json-response.png" alt="json response">
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_delete_the_unprotected_route"><a class="anchor" href="#_delete_the_unprotected_route"></a>Delete the Unprotected Route</h3>
<div class="ulist">
<ul>
<li>
<p>You visited a URL exposed directly by a Route in your OpenShift project in the first section of this guide. This endpoint was useful for testing, but is unprotected. You can now remove this public Route.</p>
</li>
<li>
<p>In the OpenShift console, click the <strong>rhoam-quarkus-openapi</strong> deployment in the Topology View.</p>
</li>
<li>
<p>Select the Resources tab in the panel that appeared.</p>
<div class="imageblock">
<div class="content">
<img src="_images/view-route.png" alt="view route">
</div>
</div>
</li>
<li>
<p>Click the <strong>rhoam-quarkus-openapi</strong> item under the Routes heading.</p>
</li>
<li>
<p>Expand the Actions dropdown and click Delete Route.</p>
<div class="paragraph">
<p><span class="image"><img src="_images/delete-route.png" alt="delete route"></span></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Congratulations! The only endpoint available to access your API now enforces API Key security.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03_lauch-sandbox.html">3. Launch the API Management Dashboard</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
